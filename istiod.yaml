apiVersion: apps/v1
kind: Deployment
metadata:
  name: istiod
  namespace: istio-system
  selfLink: /apis/apps/v1/namespaces/istio-system/deployments/istiod
  uid: 4dc9b681-b625-405a-b833-6bfaeaa2a21c
  resourceVersion: '259969'
  generation: 18
  creationTimestamp: '2021-11-15T14:59:16Z'
  labels:
    app: istiod
    install.operator.istio.io/owning-resource: unknown
    install.operator.istio.io/owning-resource-namespace: istio-system
    istio: pilot
    istio.io/rev: default
    operator.istio.io/component: Pilot
    operator.istio.io/managed: Reconcile
    operator.istio.io/version: 1.11.4
    release: istio
  annotations:
    deployment.kubernetes.io/revision: '8'
    kubectl.kubernetes.io/last-applied-configuration: >
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{"deployment.kubernetes.io/revision":"4"},"creationTimestamp":"2021-11-15T14:59:16Z","generation":10,"labels":{"app":"istiod","install.operator.istio.io/owning-resource":"unknown","install.operator.istio.io/owning-resource-namespace":"istio-system","istio":"pilot","istio.io/rev":"default","operator.istio.io/component":"Pilot","operator.istio.io/managed":"Reconcile","operator.istio.io/version":"1.11.4","release":"istio"},"managedFields":[{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:labels":{"f:app":{},"f:install.operator.istio.io/owning-resource":{},"f:install.operator.istio.io/owning-resource-namespace":{},"f:istio":{},"f:istio.io/rev":{},"f:operator.istio.io/component":{},"f:operator.istio.io/managed":{},"f:operator.istio.io/version":{},"f:release":{}}},"f:spec":{"f:replicas":{},"f:selector":{"f:matchLabels":{"f:istio":{}}},"f:strategy":{"f:rollingUpdate":{"f:maxSurge":{},"f:maxUnavailable":{}}},"f:template":{"f:metadata":{"f:annotations":{"f:prometheus.io/port":{},"f:prometheus.io/scrape":{},"f:sidecar.istio.io/inject":{}},"f:labels":{"f:app":{},"f:install.operator.istio.io/owning-resource":{},"f:istio":{},"f:istio.io/rev":{},"f:operator.istio.io/component":{},"f:sidecar.istio.io/inject":{}}},"f:spec":{"f:containers":{"k:{\"name\":\"discovery\"}":{".":{},"f:args":{},"f:env":{"k:{\"name\":\"CLUSTER_ID\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"ISTIOD_ADDR\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"JWT_POLICY\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"KUBECONFIG\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"PILOT_CERT_PROVIDER\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"PILOT_ENABLE_ANALYSIS\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"PILOT_TRACE_SAMPLING\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"POD_NAME\"}":{".":{},"f:name":{},"f:valueFrom":{"f:fieldRef":{"f:apiVersion":{},"f:fieldPath":{}}}},"k:{\"name\":\"POD_NAMESPACE\"}":{".":{},"f:name":{},"f:valueFrom":{"f:fieldRef":{"f:apiVersion":{},"f:fieldPath":{}}}},"k:{\"name\":\"REVISION\"}":{".":{},"f:name":{},"f:value":{}},"k:{\"name\":\"SERVICE_ACCOUNT\"}":{".":{},"f:name":{},"f:valueFrom":{"f:fieldRef":{"f:apiVersion":{},"f:fieldPath":{}}}}},"f:name":{},"f:ports":{"k:{\"containerPort\":15010,\"protocol\":\"TCP\"}":{".":{},"f:containerPort":{},"f:protocol":{}},"k:{\"containerPort\":15017,\"protocol\":\"TCP\"}":{".":{},"f:containerPort":{},"f:protocol":{}},"k:{\"containerPort\":8080,\"protocol\":\"TCP\"}":{".":{},"f:containerPort":{},"f:protocol":{}}},"f:readinessProbe":{"f:httpGet":{"f:path":{},"f:port":{}},"f:initialDelaySeconds":{},"f:periodSeconds":{},"f:timeoutSeconds":{}},"f:resources":{"f:requests":{"f:cpu":{},"f:memory":{}}},"f:securityContext":{"f:capabilities":{"f:drop":{}},"f:runAsGroup":{},"f:runAsNonRoot":{},"f:runAsUser":{}},"f:volumeMounts":{"k:{\"mountPath\":\"/etc/cacerts\"}":{".":{},"f:mountPath":{},"f:name":{},"f:readOnly":{}},"k:{\"mountPath\":\"/var/run/secrets/istio-dns\"}":{".":{},"f:mountPath":{},"f:name":{}},"k:{\"mountPath\":\"/var/run/secrets/remote\"}":{".":{},"f:mountPath":{},"f:name":{},"f:readOnly":{}}}}},"f:securityContext":{"f:fsGroup":{}},"f:serviceAccountName":{},"f:volumes":{"k:{\"name\":\"cacerts\"}":{".":{},"f:name":{},"f:secret":{"f:optional":{},"f:secretName":{}}},"k:{\"name\":\"istio-kubeconfig\"}":{".":{},"f:name":{},"f:secret":{"f:optional":{},"f:secretName":{}}},"k:{\"name\":\"local-certs\"}":{".":{},"f:emptyDir":{"f:medium":{}},"f:name":{}}}}}}},"manager":"istio-operator","operation":"Apply","time":"2021-11-15T14:59:16Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{"f:kubectl.kubernetes.io/last-applied-configuration":{}}},"f:spec":{"f:template":{"f:spec":{"f:containers":{"k:{\"name\":\"discovery\"}":{"f:image":{},"f:imagePullPolicy":{},"f:ports":{"k:{\"containerPort\":40000,\"protocol\":\"TCP\"}":{".":{},"f:containerPort":{},"f:protocol":{}}}}}}}}},"manager":"kubectl","operation":"Update","time":"2021-11-15T16:32:38Z"},{"apiVersion":"apps/v1","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{"f:deployment.kubernetes.io/revision":{}}},"f:status":{"f:conditions":{".":{},"k:{\"type\":\"Available\"}":{".":{},"f:lastTransitionTime":{},"f:lastUpdateTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"Progressing\"}":{".":{},"f:lastTransitionTime":{},"f:lastUpdateTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}}},"f:observedGeneration":{},"f:replicas":{},"f:unavailableReplicas":{},"f:updatedReplicas":{}}},"manager":"kube-controller-manager","operation":"Update","time":"2021-11-23T03:29:21Z"}],"name":"istiod","namespace":"istio-system","selfLink":"/apis/apps/v1/namespaces/istio-system/deployments/istiod","uid":"4dc9b681-b625-405a-b833-6bfaeaa2a21c"},"spec":{"progressDeadlineSeconds":600,"replicas":1,"revisionHistoryLimit":10,"selector":{"matchLabels":{"istio":"pilot"}},"strategy":{"rollingUpdate":{"maxSurge":"100%","maxUnavailable":"25%"},"type":"RollingUpdate"},"template":{"metadata":{"annotations":{"prometheus.io/port":"15014","prometheus.io/scrape":"true","sidecar.istio.io/inject":"false"},"creationTimestamp":null,"labels":{"app":"istiod","install.operator.istio.io/owning-resource":"unknown","istio":"pilot","istio.io/rev":"default","operator.istio.io/component":"Pilot","sidecar.istio.io/inject":"false"}},"spec":{"containers":[{"args":["discovery","--monitoringAddr=:15014","--log_output_level=default:info","--domain","cluster.local","--keepaliveMaxServerConnectionAge","30m"],"env":[{"name":"REVISION","value":"default"},{"name":"JWT_POLICY","value":"first-party-jwt"},{"name":"PILOT_CERT_PROVIDER","value":"istiod"},{"name":"POD_NAME","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.name"}}},{"name":"POD_NAMESPACE","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"metadata.namespace"}}},{"name":"SERVICE_ACCOUNT","valueFrom":{"fieldRef":{"apiVersion":"v1","fieldPath":"spec.serviceAccountName"}}},{"name":"KUBECONFIG","value":"/var/run/secrets/remote/config"},{"name":"PILOT_TRACE_SAMPLING","value":"100"},{"name":"PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND","value":"true"},{"name":"PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND","value":"true"},{"name":"ISTIOD_ADDR","value":"istiod.istio-system.svc:15012"},{"name":"PILOT_ENABLE_ANALYSIS","value":"false"},{"name":"CLUSTER_ID","value":"Kubernetes"}],"image":"istio/pilot:1.11.4","imagePullPolicy":"Never","name":"discovery","ports":[{"containerPort":8080,"protocol":"TCP"},{"containerPort":15010,"protocol":"TCP"},{"containerPort":15017,"protocol":"TCP"},{"containerPort":40000,"protocol":"TCP"}],"readinessProbe":{"failureThreshold":3,"httpGet":{"path":"/ready","port":8080,"scheme":"HTTP"},"initialDelaySeconds":1,"periodSeconds":3,"successThreshold":1,"timeoutSeconds":5},"resources":{"requests":{"cpu":"10m","memory":"100Mi"}},"securityContext":{"capabilities":{"drop":["ALL"]},"runAsGroup":1337,"runAsNonRoot":true,"runAsUser":1337},"terminationMessagePath":"/dev/termination-log","terminationMessagePolicy":"File","volumeMounts":[{"mountPath":"/var/run/secrets/istio-dns","name":"local-certs"},{"mountPath":"/etc/cacerts","name":"cacerts","readOnly":true},{"mountPath":"/var/run/secrets/remote","name":"istio-kubeconfig","readOnly":true}]}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","schedulerName":"default-scheduler","securityContext":{"fsGroup":1337},"serviceAccount":"istiod","serviceAccountName":"istiod","terminationGracePeriodSeconds":30,"volumes":[{"emptyDir":{"medium":"Memory"},"name":"local-certs"},{"name":"cacerts","secret":{"defaultMode":420,"optional":true,"secretName":"cacerts"}},{"name":"istio-kubeconfig","secret":{"defaultMode":420,"optional":true,"secretName":"istio-kubeconfig"}}]}}}}
  managedFields:
    - manager: istio-operator
      operation: Apply
      apiVersion: apps/v1
      time: '2021-11-15T14:59:16Z'
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:labels:
            f:app: {}
            f:install.operator.istio.io/owning-resource: {}
            f:install.operator.istio.io/owning-resource-namespace: {}
            f:istio: {}
            f:istio.io/rev: {}
            f:operator.istio.io/component: {}
            f:operator.istio.io/managed: {}
            f:operator.istio.io/version: {}
            f:release: {}
        f:spec:
          f:replicas: {}
          f:selector:
            f:matchLabels:
              f:istio: {}
          f:strategy:
            f:rollingUpdate:
              f:maxSurge: {}
              f:maxUnavailable: {}
          f:template:
            f:metadata:
              f:annotations:
                f:prometheus.io/port: {}
                f:prometheus.io/scrape: {}
                f:sidecar.istio.io/inject: {}
              f:labels:
                f:app: {}
                f:install.operator.istio.io/owning-resource: {}
                f:istio: {}
                f:istio.io/rev: {}
                f:operator.istio.io/component: {}
                f:sidecar.istio.io/inject: {}
            f:spec:
              f:containers:
                k:{"name":"discovery"}:
                  .: {}
                  f:args: {}
                  f:env:
                    k:{"name":"CLUSTER_ID"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"ISTIOD_ADDR"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"JWT_POLICY"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"KUBECONFIG"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"PILOT_CERT_PROVIDER"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"PILOT_ENABLE_ANALYSIS"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"PILOT_TRACE_SAMPLING"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"POD_NAME"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        f:fieldRef:
                          f:apiVersion: {}
                          f:fieldPath: {}
                    k:{"name":"POD_NAMESPACE"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        f:fieldRef:
                          f:apiVersion: {}
                          f:fieldPath: {}
                    k:{"name":"REVISION"}:
                      .: {}
                      f:name: {}
                      f:value: {}
                    k:{"name":"SERVICE_ACCOUNT"}:
                      .: {}
                      f:name: {}
                      f:valueFrom:
                        f:fieldRef:
                          f:apiVersion: {}
                          f:fieldPath: {}
                  f:name: {}
                  f:ports:
                    k:{"containerPort":8080,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
                    k:{"containerPort":15010,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
                    k:{"containerPort":15017,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
                  f:readinessProbe:
                    f:httpGet:
                      f:path: {}
                      f:port: {}
                    f:initialDelaySeconds: {}
                    f:periodSeconds: {}
                    f:timeoutSeconds: {}
                  f:resources:
                    f:requests:
                      f:cpu: {}
                      f:memory: {}
                  f:securityContext:
                    f:capabilities:
                      f:drop: {}
                    f:runAsGroup: {}
                    f:runAsNonRoot: {}
                    f:runAsUser: {}
                  f:volumeMounts:
                    k:{"mountPath":"/etc/cacerts"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                      f:readOnly: {}
                    k:{"mountPath":"/var/run/secrets/istio-dns"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                    k:{"mountPath":"/var/run/secrets/remote"}:
                      .: {}
                      f:mountPath: {}
                      f:name: {}
                      f:readOnly: {}
              f:securityContext:
                f:fsGroup: {}
              f:serviceAccountName: {}
              f:volumes:
                k:{"name":"cacerts"}:
                  .: {}
                  f:name: {}
                  f:secret:
                    f:optional: {}
                    f:secretName: {}
                k:{"name":"istio-kubeconfig"}:
                  .: {}
                  f:name: {}
                  f:secret:
                    f:optional: {}
                    f:secretName: {}
                k:{"name":"local-certs"}:
                  .: {}
                  f:emptyDir:
                    f:medium: {}
                  f:name: {}
    - manager: kubectl
      operation: Update
      apiVersion: apps/v1
      time: '2021-11-26T01:25:42Z'
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:annotations:
            f:kubectl.kubernetes.io/last-applied-configuration: {}
        f:spec:
          f:template:
            f:spec:
              f:containers:
                k:{"name":"discovery"}:
                  f:imagePullPolicy: {}
                  f:ports:
                    k:{"containerPort":40000,"protocol":"TCP"}:
                      .: {}
                      f:containerPort: {}
                      f:protocol: {}
    - manager: node-fetch
      operation: Update
      apiVersion: apps/v1
      time: '2021-12-13T14:57:37Z'
      fieldsType: FieldsV1
      fieldsV1:
        f:spec:
          f:template:
            f:spec:
              f:containers:
                k:{"name":"discovery"}:
                  f:image: {}
    - manager: kube-controller-manager
      operation: Update
      apiVersion: apps/v1
      time: '2021-12-19T18:29:50Z'
      fieldsType: FieldsV1
      fieldsV1:
        f:metadata:
          f:annotations:
            f:deployment.kubernetes.io/revision: {}
        f:status:
          f:conditions:
            .: {}
            k:{"type":"Available"}:
              .: {}
              f:lastTransitionTime: {}
              f:lastUpdateTime: {}
              f:message: {}
              f:reason: {}
              f:status: {}
              f:type: {}
            k:{"type":"Progressing"}:
              .: {}
              f:lastTransitionTime: {}
              f:lastUpdateTime: {}
              f:message: {}
              f:reason: {}
              f:status: {}
              f:type: {}
          f:observedGeneration: {}
          f:replicas: {}
          f:unavailableReplicas: {}
          f:updatedReplicas: {}
status:
  observedGeneration: 18
  replicas: 1
  updatedReplicas: 1
  unavailableReplicas: 1
  conditions:
    - type: Progressing
      status: 'True'
      lastUpdateTime: '2021-12-13T14:59:10Z'
      lastTransitionTime: '2021-11-15T14:59:16Z'
      reason: NewReplicaSetAvailable
      message: ReplicaSet "istiod-578db948b7" has successfully progressed.
    - type: Available
      status: 'False'
      lastUpdateTime: '2021-12-19T18:29:50Z'
      lastTransitionTime: '2021-12-19T18:29:50Z'
      reason: MinimumReplicasUnavailable
      message: Deployment does not have minimum availability.
spec:
  replicas: 1
  selector:
    matchLabels:
      istio: pilot
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: istiod
        install.operator.istio.io/owning-resource: unknown
        istio: pilot
        istio.io/rev: default
        operator.istio.io/component: Pilot
        sidecar.istio.io/inject: 'false'
      annotations:
        prometheus.io/port: '15014'
        prometheus.io/scrape: 'true'
        sidecar.istio.io/inject: 'false'
    spec:
      volumes:
        - name: local-certs
          emptyDir:
            medium: Memory
        - name: cacerts
          secret:
            secretName: cacerts
            defaultMode: 420
            optional: true
        - name: istio-kubeconfig
          secret:
            secretName: istio-kubeconfig
            defaultMode: 420
            optional: true
      containers:
        - name: discovery
          image: my-local/pilot:latest
          args:
            - discovery
            - '--monitoringAddr=:15014'
            - '--log_output_level=default:info'
            - '--domain'
            - cluster.local
            - '--keepaliveMaxServerConnectionAge'
            - 30m
          ports:
            - containerPort: 8080
              protocol: TCP
            - containerPort: 15010
              protocol: TCP
            - containerPort: 15017
              protocol: TCP
            - containerPort: 40000
              protocol: TCP
          env:
            - name: REVISION
              value: default
            - name: JWT_POLICY
              value: first-party-jwt
            - name: PILOT_CERT_PROVIDER
              value: istiod
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.name
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: metadata.namespace
            - name: SERVICE_ACCOUNT
              valueFrom:
                fieldRef:
                  apiVersion: v1
                  fieldPath: spec.serviceAccountName
            - name: KUBECONFIG
              value: /var/run/secrets/remote/config
            - name: PILOT_TRACE_SAMPLING
              value: '100'
            - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND
              value: 'true'
            - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND
              value: 'true'
            - name: ISTIOD_ADDR
              value: istiod.istio-system.svc:15012
            - name: PILOT_ENABLE_ANALYSIS
              value: 'false'
            - name: CLUSTER_ID
              value: Kubernetes
          resources:
            requests:
              cpu: 10m
              memory: 100Mi
          volumeMounts:
            - name: local-certs
              mountPath: /var/run/secrets/istio-dns
            - name: cacerts
              readOnly: true
              mountPath: /etc/cacerts
            - name: istio-kubeconfig
              readOnly: true
              mountPath: /var/run/secrets/remote
          readinessProbe:
            httpGet:
              path: /ready
              port: 8080
              scheme: HTTP
            initialDelaySeconds: 1
            timeoutSeconds: 5
            periodSeconds: 3
            successThreshold: 1
            failureThreshold: 3
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          imagePullPolicy: Never
          securityContext:
            capabilities:
              drop:
                - ALL
            runAsUser: 1337
            runAsGroup: 1337
            runAsNonRoot: true
      restartPolicy: Always
      terminationGracePeriodSeconds: 30
      dnsPolicy: ClusterFirst
      serviceAccountName: istiod
      serviceAccount: istiod
      securityContext:
        fsGroup: 1337
      schedulerName: default-scheduler
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 25%
      maxSurge: 100%
  revisionHistoryLimit: 10
  progressDeadlineSeconds: 600
